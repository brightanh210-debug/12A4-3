
<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Qu√† 12A4 ‚Äî Nh√¢n ng√†y c·ªßa c√°c b·∫°n n·ªØ</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="wrap">
  <header>
    <h1>üéÅ Qu√† b·∫•t ng·ªù cho c√°c b·∫°n n·ªØ 12A4</h1>
    <p class="lead">G√µ t√™n v√† nh·∫≠p m·∫≠t kh·∫©u chung ƒë·ªÉ m·ªü m√≥n qu√† ri√™ng nh√©.</p>
  </header>

  <main class="card">
    <div class="form-row" id="formRow">
      <input id="name" type="search" placeholder="G√µ t√™n (v√≠ d·ª•: Nguy·ªÖn Ng·ªçc Linh Giang)" autocomplete="off">
      <div style="position:relative">
        <input id="pass" type="password" placeholder="M·∫≠t kh·∫©u chung">
        <button id="togglePass" class="tiny">Hi·ªán</button>
      </div>
      <button id="btn" class="btn">M·ªü qu√†</button>
    </div>

    <div id="feedback" class="feedback"></div>
    <div id="suggestions" class="suggestions"></div>

    <section id="profile" class="profile hidden" aria-hidden="true">
      <div id="giftArea" class="gift-area hidden" aria-hidden="true">
        <div id="giftBox" class="gift-box" title="Nh·∫•n ƒë·ªÉ m·ªü qu√†">üéÅ</div>
      </div>

      <div class="profile-cover" id="profileCover">
        <div class="profile-header">
          <h2 id="pname"></h2>
          <div class="meta">L·ªõp 12A4 ‚Äî Tr∆∞·ªùng THPT L√™ Qu√Ω ƒê√¥n<br>Ch·ªß nhi·ªám: Nguy·ªÖn Thanh T√¢m</div>
        </div>
      </div>

      <div class="profile-card" id="profileCard">
        <div class="info-line" id="infoLine"></div>
        <div class="poem-wrap"><h3>üíå L·ªùi ch√∫c</h3><div id="poem" class="poem"></div></div>
        <div id="videoBox" class="videoBox"></div>
        <div class="links" id="links"></div>
        <button id="copyLink" class="mini">Copy link c√° nh√¢n</button>
        <div class="note">M·∫≠t kh·∫©u chung: <strong>C√°c b·∫°n nam 12A4 ƒë·∫πp trai</strong></div>
        <a id="back" class="back">‚Üê Quay l·∫°i</a>
      </div>

      <div id="teddy" class="overlay left">üß∏</div>
      <div id="flower" class="overlay right">üå∏</div>
    </section>
  </main>

  <footer>Made with ‚ù§Ô∏è ‚Äî L·ªõp 12A4</footer>
</div>

<canvas id="confetti-canvas" class="confetti-canvas"></canvas>

<script>
const PASSWORD = "C√°c b·∫°n nam 12A4 ƒë·∫πp trai";
// default video (Drive preview link used for all profiles initially)
const DEFAULT_VIDEO = "https://youtu.be/KvABsXcZxkU?si=XwSKMcv705ebVtlH";

let PROFILES = [];
fetch('profiles.json').then(r=>r.json()).then(data=>{ PROFILES = data; lookup = PROFILES.map(p=>({...p, norm: normalize(p.name)})); }).catch(e=>{ console.log('profiles load err', e); });

function normalize(s){ if(!s) return ''; s = s.toLowerCase(); const map = {'√†':'a','√°':'a','·∫°':'a','·∫£':'a','√£':'a','√¢':'a','·∫ß':'a','·∫•':'a','·∫≠':'a','·∫©':'a','·∫´':'a','ƒÉ':'a','·∫±':'a','·∫Ø':'a','·∫∑':'a','·∫≥':'a','·∫µ':'a','√®':'e','√©':'e','·∫π':'e','·∫ª':'e','·∫Ω':'e','√™':'e','·ªÅ':'e','·∫ø':'e','·ªá':'e','·ªÉ':'e','·ªÖ':'e','√¨':'i','√≠':'i','·ªã':'i','·ªâ':'i','ƒ©':'i','√≤':'o','√≥':'o','·ªç':'o','·ªè':'o','√µ':'o','√¥':'o','·ªì':'o','·ªë':'o','·ªô':'o','·ªï':'o','·ªó':'o','∆°':'o','·ªù':'o','·ªõ':'o','·ª£':'o','·ªü':'o','·ª°':'o','√π':'u','√∫':'u','·ª•':'u','·ªß':'u','≈©':'u','∆∞':'u','·ª´':'u','·ª©':'u','·ª±':'u','·ª≠':'u','·ªØ':'u','·ª≥':'y','√Ω':'y','·ªµ':'y','·ª∑':'y','·ªπ':'y','ƒë':'d'}; let out=''; for(const ch of s) out += map[ch] || ch; out = out.replace(/[^\w\s-]/g,'').replace(/\s+/g,' ').trim(); return out.replace(/\s+/g,'').toLowerCase(); }
function levenshtein(a,b){ if(a===b) return 0; const al=a.length, bl=b.length; if(al===0) return bl; if(bl===0) return al; const dp = Array(al+1).fill(null).map(()=>Array(bl+1).fill(0)); for(let i=0;i<=al;i++) dp[i][0]=i; for(let j=0;j<=bl;j++) dp[0][j]=j; for(let i=1;i<=al;i++){ for(let j=1;j<=bl;j++){ const cost = a[i-1]===b[j-1]?0:1; dp[i][j] = Math.min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+cost); }} return dp[al][bl]; }
function passwordAccepts(input){ const nInput = normalize(input); const nPass = normalize(PASSWORD); if(nInput === nPass) return true; const d = levenshtein(nInput, nPass); const ratio = d / Math.max(nInput.length, nPass.length); return (d <= 2) || (ratio <= 0.18); }

// DOM refs
const nameInput = document.getElementById('name');
const passInput = document.getElementById('pass');
const btn = document.getElementById('btn');
const togglePass = document.getElementById('togglePass');
const feedback = document.getElementById('feedback');
const suggestions = document.getElementById('suggestions');
const formRow = document.getElementById('formRow');
const profileSection = document.getElementById('profile');
const giftArea = document.getElementById('giftArea');
const giftBox = document.getElementById('giftBox');
const pname = document.getElementById('pname');
const poemEl = document.getElementById('poem');
const videoBox = document.getElementById('videoBox');
const copyBtn = document.getElementById('copyLink');
const back = document.getElementById('back');
const profileCover = document.getElementById('profileCover');
const infoLine = document.getElementById('infoLine');
const linksDiv = document.getElementById('links');
const teddy = document.getElementById('teddy');
const flower = document.getElementById('flower');
const confettiCanvas = document.getElementById('confetti-canvas');
const ctx = confettiCanvas.getContext('2d');

function resizeCanvas(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas); resizeCanvas();

function renderSuggestions(q){ suggestions.innerHTML=''; if(!q) return; const nq = normalize(q); const matched = lookup.filter(p=> p.norm.includes(nq)).slice(0,8); if(matched.length===0){ suggestions.innerHTML = "<div class='sug'>Kh√¥ng t√¨m th·∫•y. Th·ª≠ g√µ kh√¥ng d·∫•u.</div>"; return; } matched.forEach(p=>{ const d = document.createElement('div'); d.className='sug'; d.textContent=p.name; d.onclick = ()=>{ nameInput.value = p.name; suggestions.innerHTML=''; }; suggestions.appendChild(d); }); }

nameInput.addEventListener('input', e=> renderSuggestions(e.target.value));
nameInput.addEventListener('keydown', e=> { if(e.key==='Enter') passInput.focus(); });
passInput.addEventListener('keydown', e=> { if(e.key==='Enter') doOpen(); });
btn.addEventListener('click', doOpen);
togglePass.addEventListener('click', ()=>{ if(passInput.type==='password'){ passInput.type='text'; togglePass.textContent='·∫®n'; } else { passInput.type='password'; togglePass.textContent='Hi·ªán'; } });

function showIncorrectPassword(){ passInput.value=''; feedback.innerHTML = "<div class='err'>∆† k√¨a c√°c b·∫°n Nam 12A4 r·∫•t ƒë·∫πp trai lu√¥n √° ü•≤</div>"; setTimeout(()=> feedback.innerHTML='', 5000); }

function throwConfetti(){ const pieces=[]; const colors=['#ff6fa3','#ffd166','#a0e7e5','#bdb2ff','#ffd6e8','#ff9bb8']; for(let i=0;i<120;i++){ pieces.push({ x: Math.random()*confettiCanvas.width, y: -Math.random()*confettiCanvas.height, w:6+Math.random()*8, h:6+Math.random()*8, vx:(Math.random()-0.5)*4, vy:2+Math.random()*6, color: colors[Math.floor(Math.random()*colors.length)]}); } let t=0; function frame(){ t++; ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height); for(const p of pieces){ p.x+=p.vx; p.y+=p.vy; p.vy+=0.05; ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,p.w,p.h);} if(t<200) requestAnimationFrame(frame); else ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height); } requestAnimationFrame(frame); }

function playExplosion(){ try{ const actx = new (window.AudioContext||window.webkitAudioContext)(); const o = actx.createOscillator(); const g = actx.createGain(); o.type='sawtooth'; o.frequency.setValueAtTime(300, actx.currentTime); o.frequency.exponentialRampToValueAtTime(60, actx.currentTime+0.6); g.gain.setValueAtTime(0.4, actx.currentTime); g.gain.exponentialRampToValueAtTime(0.001, actx.currentTime+0.9); o.connect(g); g.connect(actx.destination); o.start(); o.stop(actx.currentTime+0.9); }catch(e){} }

let bgCtx=null;
function playBackground(){ try{ if(!bgCtx) bgCtx = new (window.AudioContext||window.webkitAudioContext)(); const g = bgCtx.createGain(); g.gain.value = 0.06; g.connect(bgCtx.destination); const freqs=[220,330,440]; for(let i=0;i<3;i++){ const o = bgCtx.createOscillator(); o.type='sine'; o.frequency.value = freqs[i]; o.connect(g); o.start(); setTimeout(()=> o.stop(), 6000); } }catch(e){} }

function findUserByName(q){ const nq = normalize(q); return lookup.find(p => p.norm === nq) || lookup.find(p => p.norm.includes(nq)) || lookup.find(p => p.id === nq.replace(/\s+/g,'-')); }

function doOpen(){ const nameQ = nameInput.value.trim(); const passQ = passInput.value.trim(); if(!nameQ){ alert('Nh·∫≠p t√™n ƒëi nh√©.'); nameInput.focus(); return; } if(!passQ){ alert('Nh·∫≠p m·∫≠t kh·∫©u chung.'); passInput.focus(); return; } if(!passwordAccepts(passQ)){ showIncorrectPassword(); passInput.focus(); return; } const user = findUserByName(nameQ); if(!user){ alert('Kh√¥ng t√¨m th·∫•y t√™n. Th·ª≠ g√µ kh√¥ng d·∫•u ho·∫∑c m·ªôt ph·∫ßn t√™n.'); return; } profileSection.classList.remove('hidden'); giftArea.classList.remove('hidden'); formRow.style.display='none'; suggestions.innerHTML=''; feedback.innerHTML=''; giftBox.classList.remove('exploded','ready'); giftBox.classList.add('shaking'); giftBox.style.pointerEvents='none'; setTimeout(()=>{ giftBox.classList.remove('shaking'); giftBox.classList.add('ready'); giftBox.style.pointerEvents='auto'; }, 6*220 + 200); giftBox.onclick = ()=>{ if(!giftBox.classList.contains('ready')) return; playExplosion(); throwConfetti(); playBackground(); giftBox.classList.add('exploded'); setTimeout(()=>{ openProfile(user); }, 600); }; document.getElementById('profileCover').style.background = user.color || '#fff0f6'; document.getElementById('pname').textContent = user.name; document.getElementById('teddy').style.display = 'block'; document.getElementById('flower').style.display = 'block'; location.hash = user.id; }

function openProfile(user){ document.getElementById('poem').innerHTML = "<pre>"+(user.poem||"")+"</pre>"; const vb = document.getElementById('videoBox'); vb.innerHTML=''; const videoUrl = (user.video && user.video.trim()) ? user.video : DEFAULT_VIDEO; if(videoUrl){ if(videoUrl.includes('drive.google.com')){ // embed drive preview in iframe
      const src = videoUrl.replace('/view','/preview');
      const iframe = document.createElement('iframe');
      iframe.src = src;
      iframe.allow = "autoplay; encrypted-media; fullscreen; accelerometer; clipboard-write; picture-in-picture";
      iframe.allowFullscreen = true;
      iframe.style.width='100%'; iframe.style.height='420px'; iframe.style.border='0';
      vb.appendChild(iframe);
    } else {
      const y = videoUrl.match(/(youtu\.be\/|v=|\/shorts\/)([A-Za-z0-9_-]{4,})/);
      if(y){ let id = null; try { if(videoUrl.includes('v=')) id = (new URL(videoUrl)).searchParams.get('v'); else id = videoUrl.split('/').pop(); } catch(e){ id = videoUrl.split('/').pop(); } const src = id ? ("https://www.youtube.com/embed/"+id+"?autoplay=1") : videoUrl; const iframe = document.createElement('iframe'); iframe.src = src; iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; picture-in-picture"; iframe.allowFullscreen = true; vb.appendChild(iframe); } else { const v = document.createElement('video'); v.controls=true; v.autoplay = true; const s = document.createElement('source'); s.src = videoUrl; s.type='video/mp4'; v.appendChild(s); vb.appendChild(v); } } } infoLine.innerHTML = "<strong>"+(user.name||"")+"</strong> ‚Äî "+(user.nickname?user.nickname+" ‚Ä¢ ":"")+ (user.dob? "Sinh: "+user.dob+" ‚Ä¢ ":"") + "L·ªõp 12A4"; linksDiv.innerHTML = user.profile ? ('<a href="'+user.profile+'" target="_blank" rel="noreferrer">Trang c√° nh√¢n</a>') : ''; document.getElementById('profileCard').scrollIntoView({behavior:'smooth', block:'center'}); }

copyBtn.addEventListener('click', async ()=>{ const id = location.hash.replace('#','') || normalize(nameInput.value).replace(/\s+/g,'-'); const url = location.origin + location.pathname + "#" + id; try{ await navigator.clipboard.writeText(url); copyBtn.textContent = "ƒê√£ copy ‚úì"; setTimeout(()=> copyBtn.textContent = "Copy link c√° nh√¢n", 1500); }catch(e){ alert("Kh√¥ng copy ƒë∆∞·ª£c t·ª± ƒë·ªông, m√†y copy th·ªß c√¥ng link tr√™n thanh ƒë·ªãa ch·ªâ nh√©."); } });

back.addEventListener('click', ()=>{ profileSection.classList.add('hidden'); profileSection.setAttribute('aria-hidden','true'); giftArea.classList.add('hidden'); formRow.style.display=''; location.hash=''; document.getElementById('teddy').style.display='none'; document.getElementById('flower').style.display='none'; });

window.addEventListener('load', ()=>{ if(PROFILES.length>0){ lookup = PROFILES.map(p=>({...p, norm: normalize(p.name)})); } const h = location.hash.replace('#',''); if(!h) return; const u = lookup.find(x=> x.id===h || x.idNorm===h); if(u){ nameInput.value = u.name; renderSuggestions(u.name); } });
</script>
</body>
</html>
